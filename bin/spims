#! /usr/bin/env python

import sys
import os
import Image

sys.path.append("../src/")

if __name__ == "__main__":
    import spims
    from optparse import OptionParser
    parser = OptionParser()
    parser.add_option("-p", "--pattern", dest="pattern", help="Image to search for.", metavar="PATTERN_FILE")
    parser.add_option("-s", "--source", dest="source", help="Image to search for", metavar="SOURCE_FILE")
    parser.add_option("--pdir", "--pattern_dir", dest="pattern_dir", help="Directory of images to search for.", metavar="PATTERN_DIR")
    parser.add_option("--sdir", "--source_dir", dest="source_dir", help="Directory of images to search for", metavar="SOURCE_DIR")
    parser.add_option("-d", dest="debug", help="Debug Mode", action="store_true", default=False)

    (options, args) = parser.parse_args()
    patterns = None
    sources = None
    if options.pattern and os.path.isfile(options.pattern):
        patterns = [options.pattern]
    if options.source and os.path.isfile(options.source):
        sources = [options.source]
    if options.pattern_dir and os.path.isdir(options.pattern_dir):
        patterns = map(lambda x: options.pattern_dir + x, os.listdir(options.pattern_dir))
    if options.source_dir and os.path.isdir(options.source_dir):
        sources = map(lambda x: options.source_dir + x, os.listdir(options.source_dir))

    if patterns is None:
        parser.error('Pattern file or directory must be provided')
    if sources is None:
        parser.error('Source file or directory must be provided')
    else:
        spims.match_dirs(patterns, sources, options.debug)
